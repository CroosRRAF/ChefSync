<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Menu Fix Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .food-item { border: 1px solid #ccc; padding: 10px; margin: 10px; border-radius: 5px; }
        .food-image { width: 200px; height: 150px; object-fit: cover; border-radius: 5px; }
        .price-info { background: #f5f5f5; padding: 8px; margin-top: 10px; border-radius: 3px; }
        .error { color: red; }
        .success { color: green; }
    </style>
</head>
<body>
    <h1>ChefSync Menu Fix Test</h1>
    <div id="results"></div>

    <script>
        async function testMenuAPI() {
            const results = document.getElementById('results');
            
            try {
                results.innerHTML += '<p>Testing API endpoint...</p>';
                
                const response = await fetch('http://localhost:8000/api/food/customer/foods/');
                const data = await response.json();
                
                if (data.results && data.results.length > 0) {
                    results.innerHTML += `<p class="success">✅ API responded with ${data.results.length} food items</p>`;
                    
                    // Test first 3 items
                    const testItems = data.results.slice(0, 3);
                    
                    testItems.forEach((item, index) => {
                        const div = document.createElement('div');
                        div.className = 'food-item';
                        
                        // Test image URL
                        const imageUrl = item.primary_image || item.image_url || 'https://via.placeholder.com/200x150?text=No+Image';
                        const imageStatus = item.primary_image ? '✅ Image available' : '❌ No image';
                        
                        // Test prices
                        const pricesAvailable = item.prices && item.prices.length > 0;
                        const priceStatus = pricesAvailable ? `✅ ${item.prices.length} price(s) available` : '❌ No prices';
                        
                        let priceInfo = '';
                        if (pricesAvailable) {
                            const bestPrice = item.prices.reduce((min, price) => 
                                parseFloat(price.price) < parseFloat(min.price) ? price : min
                            );
                            priceInfo = `
                                <div class="price-info">
                                    <strong>Best Price: LKR ${parseFloat(bestPrice.price).toFixed(2)}</strong> (${bestPrice.size})<br>
                                    <strong>Cook:</strong> ${bestPrice.cook_name}<br>
                                    <strong>Rating:</strong> ${bestPrice.cook_rating ? parseFloat(bestPrice.cook_rating).toFixed(1) : 'N/A'}
                                </div>
                            `;
                        }
                        
                        div.innerHTML = `
                            <h3>${item.name}</h3>
                            <img src="${imageUrl}" alt="${item.name}" class="food-image" onerror="this.src='https://via.placeholder.com/200x150?text=Error'">
                            <p><strong>Description:</strong> ${item.description}</p>
                            <p><strong>Image Status:</strong> ${imageStatus}</p>
                            <p><strong>Price Status:</strong> ${priceStatus}</p>
                            <p><strong>Available Cooks:</strong> ${item.available_cooks_count}</p>
                            ${priceInfo}
                        `;
                        
                        results.appendChild(div);
                    });
                } else {
                    results.innerHTML += '<p class="error">❌ No food items received</p>';
                }
                
            } catch (error) {
                results.innerHTML += `<p class="error">❌ Error: ${error.message}</p>`;
                console.error('Test error:', error);
            }
        }
        
        // Run test when page loads
        testMenuAPI();
    </script>
</body>
</html>